<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  <!-- SEO meta tags -->
  <meta name="description" content="Personal website of Mastaan Randhawa. Discover my portfolio, resume, and blog.">
  <meta name="keywords" content="Personal website, portfolio, blog, resume, software developer, skills">
  <meta name="author" content="Mastaan Randhawa">

  <title>Mastaan Randhawa - Personal Website</title>

  <!-- Preload the hero image (critical) -->
  <link rel="preload" href="imgs/mastaanPhoto.JPEG" as="image">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=open_in_new" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Architects+Daughter&display=swap" rel="stylesheet">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Link to CSS (add your stylesheet path here) -->
  <link rel="stylesheet" href="styles.css">

  <link rel="icon" type="favicon" href="imgs/favicon.webp">

  <!-- Open Graph Meta Tags for Social Sharing -->
  <meta property="og:title" content="Mastaan Randhawa - Personal Website">
  <meta property="og:description" content="Check out my portfolio, blog, and resume.">
  <meta property="og:image" content="imgs/mastaanPhoto.JPEG">
  <meta property="og:url" content="https://mastaanrandhawa.com">
  <meta name="twitter:card" content="summary_large_image">

  <!-- //Google Verification -->
  <meta name="google-site-verification" content="N9wcjQygssMnsNWb5JwXJ25YVHvyWET3ZrScYH4qa-4" />
</head>

<body>
  <!-- Header Section -->
  <header>
    <nav>
      <button class="burger" onclick="toggleMenu()">‚ò∞</button>
      <ul id="menu">
        <li><a href="#portfolio">PORTFOLIO</a></li>
        <li><a href="#about">ABOUT</a></li>
        <li><a href="#resume">RESUME</a></li>
        <li><a href="#contact">CONTACT</a></li>
      </ul>
    </nav>
  </header>

  <!-- Intro Section -->
  <section class="py-5">
    <div class="container">
      <div class="row align-items-center">
        <div class="hero-content">
          <h1>Hi, I am Mastaan Randhawa.</h1>
          <p>I am <span class="typewriter-text typeWriterspan"></span></p>

          <a href="#portfolio">
            <input type="submit" value="Explore" class="btn btn-primary rounded-0 py-2 px-4">
          </a>
          <!-- Social Links -->
          <div class="social-links mt-4">
            <!-- Inline SVG for GitHub -->
            <a href="https://github.com/mastaanRandhawa" target="_blank" style="margin-right: 10px;">
              <svg class="imglogo" width="32" height="32" viewBox="0 0 24 24" fill="#2c3e50"
                xmlns="http://www.w3.org/2000/svg" aria-label="GitHub Logo">
                <path d="M12 .297c-6.626 0-12 5.373-12 12 
                         0 5.303 3.438 9.8 8.205 11.385.599.113.82-.26.82-.577 
                         0-.285-.01-1.04-.016-2.04-3.338.726-4.042-1.61-4.042-1.61 
                         -.546-1.387-1.333-1.757-1.333-1.757-1.089-.744.084-.729.084-.729 
                         1.205.084 1.84 1.236 1.84 1.236 1.07 1.835 2.809 1.304 3.495.997 
                         .108-.776.418-1.305.76-1.605-2.665-.305-5.466-1.333-5.466-5.93 
                         0-1.31.469-2.381 1.236-3.221-.124-.304-.536-1.527.117-3.176 
                         0 0 1.008-.322 3.301 1.23a11.52 11.52 0 0 1 3.003-.404 
                         c1.018.005 2.042.138 3.003.404 2.291-1.552 3.297-1.23 3.297-1.23 
                         .655 1.649.243 2.872.119 3.176.77.84 1.236 1.911 1.236 3.221 
                         0 4.61-2.805 5.622-5.476 5.92.43.372.81 1.102.81 2.222 
                         0 1.604-.014 2.897-.014 3.293 0 .319.217.694.824.576 
                         4.765-1.587 8.2-6.082 8.2-11.384 0-6.627-5.373-12-12-12z" />
              </svg>
            </a>
            <!-- Inline SVG for LinkedIn -->
            <a href="https://linkedin.com/in/MastaanRandhawa" target="_blank">
              <svg class="imglogo" width="32" height="32" viewBox="0 0 24 24" fill="#2c3e50"
                xmlns="http://www.w3.org/2000/svg" aria-label="LinkedIn Logo">
                <path d="M19 0h-14c-2.76 0-5 2.24-5 5v14 
                         c0 2.76 2.24 5 5 5h14c2.76 0 5-2.24 5-5v-14 
                         c0-2.76-2.24-5-5-5zm-11 19h-3v-10h3v10zm-1.5-11.27 
                         c-.97 0-1.75-.79-1.75-1.76s.78-1.75 
                         1.75-1.75 1.75.78 1.75 1.75 
                         -.78 1.76-1.75 1.76zm12.5 11.27h-3v-5.6c0-1.34 
                         -.03-3.07-1.87-3.07-1.87 0-2.16 1.46-2.16 2.97v5.7h-3v-10h2.88v1.37h.04 
                         c.4-.75 1.38-1.54 2.83-1.54 3.03 0 3.59 2 3.59 4.53v5.64z" />
              </svg>
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Portfolio Section -->
  <section class="portfolioBG">
    <section id="portfolio">
      <!-- Web Development Section -->
      <h2>PORTFOLIO</h2>
      <div class="portfolio-items web-portfolio">

        <!-- AK WRAPS WEBSITE (THREE.js, HTML, CSS, Bootstrap, JavaScript) -->
        <div class="card">
          <img data-src="imgs/akwrapsimage.png" class="lazyload img-fluid" alt="AK Wraps Website Screenshot"
            loading="lazy">
          <h3>AK WRAPS WEBSITE</h3>
          <ul class="cardList">
            <li>
              <img src="imgs/threejslogo.svg" alt="Three.js logo">
            </li>
            <li>
              <img src="imgs/jslogo.svg" alt="JavaScript logo">
            </li>
            <li>
              <img src="imgs/bootstrap-plainlogo.svg" alt="Bootstrap logo">
            </li>
            <li>
              <img src="imgs/docker-plainlogo.svg" alt="Docker logo">
            </li>
          </ul>
          <p>
            Designed and built the AK Wraps website using THREEjs, HTML, CSS, Bootstrap,
            and JavaScript, creating an engaging and responsive user experience.
          </p>
          <a href="https://akwraps.ca/landingPage" target="_blank">
            <span class="material-symbols-outlined">open_in_new</span>
          </a>
        </div>

        <!-- RISC-V PROCESSOR (C/C++/Assembly) -->
        <div class="card">
          <img data-src="imgs/coding.webp" class="lazyload img-fluid" alt="RISC-V Processor Screenshot" loading="lazy">
          <h3>RISC-V PROCESSOR</h3>
          <ul class="cardList">
            <li>
              <img src="imgs/clogo.svg" alt="C logo">
            </li>
            <li>
              <img src="imgs/C++logo.svg" alt="C++ logo">
            </li>
          </ul>
          <p>
            Developed a RISC-V processor in C/C++/Assembly, implementing RISC-V instructions with custom slt-type
            instructions.
          </p>
        </div>

        <!-- Custom ls Command Implementation in C (C) -->
        <div class="card">
          <img data-src="imgs/coding.webp" class="lazyload img-fluid" alt="Custom ls Command Project Screenshot"
            loading="lazy">
          <h3>LS IMPLEMENTATION</h3>
          <ul class="cardList">
            <li>
              <img src="imgs/clogo.svg" alt="C logo">
            </li>
          </ul>
          <p>
            Developed a custom `ls` command in C, mimicking Unix's ls utility with options for inode display and
            long-format listing.
          </p>
        </div>

        <!-- Multi-level Cache System (C/C++) -->
        <div class="card">
          <img data-src="imgs/coding.webp" class="lazyload img-fluid" alt="Multi-level Cache System Screenshot"
            loading="lazy">
          <h3>LEVELED CACHE SYSTEM</h3>
          <ul class="cardList">
            <li>
              <img src="imgs/clogo.svg" alt="C logo">
            </li>
            <li>
              <img src="imgs/C++logo.svg" alt="C++ logo">
            </li>
          </ul>
          <p>
            Developed and managed multiple cache projects using C/C++. Implemented LRU and LFU eviction policies.
          </p>
        </div>

        <!-- Concurrent Data Communication in C (C) -->
        <div class="card">
          <img data-src="imgs/coding.webp" class="lazyload img-fluid" alt="Concurrent Data Communication Screenshot"
            loading="lazy">
          <h3>DATA COMMUNICATION</h3>
          <ul class="cardList">
            <li>
              <img src="imgs/clogo.svg" alt="C logo">
            </li>
          </ul>
          <p>
            Created a framework for concurrent data communication in C, using mutex locks to ensure thread-safe
            operations.
          </p>
        </div>

        <!-- Inter-Process Communication and Global Variable Management in C (C) -->
        <div class="card">
          <img data-src="imgs/coding.webp" class="lazyload img-fluid" alt="Inter-Process Communication Screenshot"
            loading="lazy">
          <h3>IPC IMPLEMENTATION</h3>
          <ul class="cardList">
            <li>
              <img src="imgs/clogo.svg" alt="C logo">
            </li>
          </ul>
          <p>
            Built an architecture for IPC and global variable management in C. Supports POSIX IPC mechanisms.
          </p>
        </div>

        <!-- FERRARI WEBSITE (HTML, CSS, JavaScript, Bootstrap) -->
        <div class="card">
          <img data-src="imgs/ferrariWebsite.png" class="lazyload img-fluid" alt="Ferrari Website Screenshot"
            loading="lazy">
          <h3>FERRARI WEBSITE</h3>
          <ul class="cardList">
            <li>
              <img src="imgs/htmllogo.svg" alt="HTML logo">
            </li>
            <li>
              <img src="imgs/csslogo.svg" alt="CSS logo">
            </li>
            <li>
              <img src="imgs/jslogo.svg" alt="JavaScript logo">
            </li>
            <li>
              <img src="imgs/bootstrap-plainlogo.svg" alt="Bootstrap logo">
            </li>
          </ul>
          <p>
            Developed a custom Ferrari-themed website, showcasing my front-end development skills
            through an elegant and dynamic design.
          </p>
          <a href="https://mastaanrandhawa.github.io/Ferrari-Website/" target="_blank">
            <span class="material-symbols-outlined">open_in_new</span>
          </a>
        </div>

        <!-- ROAR BIKE WEBSITE (HTML, CSS, JavaScript, Bootstrap) -->
        <div class="card">
          <img data-src="imgs/roarcycle.png" class="lazyload img-fluid" alt="Roar Cycle Website Screenshot"
            loading="lazy">
          <h3>ROAR BIKE WEBSITE</h3>
          <ul class="cardList">
            <li>
              <img src="imgs/htmllogo.svg" alt="HTML logo">
            </li>
            <li>
              <img src="imgs/csslogo.svg" alt="CSS logo">
            </li>
            <li>
              <img src="imgs/jslogo.svg" alt="JavaScript logo">
            </li>
            <li>
              <img src="imgs/bootstrap-plainlogo.svg" alt="Bootstrap logo">
            </li>
          </ul>
          <p>
            Developed a mobile bike repair service website, emphasizing user-friendly design
            and streamlined booking to enhance customer convenience.
          </p>
          <a href="https://mastaanrandhawa.github.io/Roar-Cycle/" target="_blank">
            <span class="material-symbols-outlined">open_in_new</span>
          </a>
        </div>

        <!-- LOGO WEBSITE (HTML, CSS, JavaScript, Bootstrap) -->
        <div class="card">
          <img data-src="imgs/logoWebsite.png" class="lazyload img-fluid" alt="Logo Website Screenshot" loading="lazy">
          <h3>LOGO WEBSITE</h3>
          <ul class="cardList">
            <li>
              <img src="imgs/htmllogo.svg" alt="HTML logo">
            </li>
            <li>
              <img src="imgs/csslogo.svg" alt="CSS logo">
            </li>
            <li>
              <img src="imgs/jslogo.svg" alt="JavaScript logo">
            </li>
            <li>
              <img src="imgs/bootstrap-plainlogo.svg" alt="Bootstrap logo">
            </li>
          </ul>
          <p>
            Developed a professional logo design site, demonstrating expertise in creating seamless user experiences.
          </p>
          <a href="https://mastaanrandhawa.github.io/Logo-Design-Website/" target="_blank">
            <span class="material-symbols-outlined">open_in_new</span>
          </a>
        </div>

      </div>

      <button id="show-more-web" class="btn btn-primary mt-4">Show More</button>
      <a href="#portfolio">
        <button id="hide-web" class="btn btn-primary mt-4 hidden">Back</button>
      </a>

    </section>
  </section>

  <!-- About Section -->
  <section id="about">
    <h2>ABOUT ME</h2>
    <!-- 3D Scene Container -->
    <div id="three-container" style="width: 100%; height: 500px; position: relative;">
      <!-- The 3D canvas will be appended here via JavaScript -->
    </div>
    <p> From a small town in India to the bustling tech scene of Canada, my journey has been anything but ordinary. I‚Äôm
      Mastaan Randhawa‚Äîa Software Developer and Computer Science student at Simon Fraser University with a passion for
      turning challenges into opportunities. My ambition extends beyond coding; I aspire to travel the world, aiding
      those in need, and eventually venturing into tech sales.</p>

  </section>

  <!-- Resume Section -->
  <section id="resume">
    <h2>RESUME</h2>
    <a href="Mastaan's Resume 2025.pdf" target="_blank">
      <input type="submit" value="View Resume" class="btn btn-primary">
    </a>
  </section>

  <!-- Contact Section -->
  <section id="contact">
    <h2>CONTACT ME</h2>
    <p>If you‚Äôd like to get in touch, drop me an email using the form below.</p>
    <form class="border-right pr-5 mb-5" id="contactForm">
      <div class="row">
        <div class="col-md-6 form-group">
          <input type="text" class="form-control" name="fname" id="fname" placeholder="First name" required />
        </div>
        <div class="col-md-6 form-group">
          <input type="text" class="form-control" name="lname" id="lname" placeholder="Last name" required />
        </div>
      </div>
      <div class="row">
        <div class="col-md-12 form-group">
          <input type="email" class="form-control" name="email" id="email" placeholder="Email" required />
        </div>
      </div>
      <div class="row">
        <div class="col-md-12 form-group">
          <textarea class="form-control" name="message" id="message" cols="30" rows="25" placeholder="Message"
            required></textarea>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <button type="submit" class="btn btn-primary">Send Message</button>
        </div>
      </div>
    </form>
    <div id="form-message-warning mt-4"></div>
    <div id="form-message-success">Your message was sent, thank you!</div>
  </section>

  <!-- Footer Section -->
  <footer>
    <p>&copy; 2024 Mastaan Randhawa. All rights reserved.</p>
  </footer>

  <!-- Include EmailJS SDK -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script type="text/javascript">
    (function () {
      emailjs.init("M5PuNXGJVcJ1G8kQU"); // Your public key
    })();

    document.getElementById('contactForm').addEventListener('submit', function (event) {
      event.preventDefault(); // Prevent default form submission

      emailjs.sendForm('service_1el02mt', 'template_y61qgki', this)
        .then(function () {
          document.getElementById("form-message-success").style.display = "block"; // Show success message
          document.getElementById("form-message-warning").style.display = "none"; // Hide warning message
          document.getElementById("contactForm").reset(); // Reset form fields
        }, function (error) {
          console.error("EmailJS error: ", error);
          document.getElementById("form-message-warning").textContent = "Failed to send your message. Please try again.";
          document.getElementById("form-message-warning").style.display = "block"; // Show warning message
          document.getElementById("form-message-success").style.display = "none"; // Hide success message
        });
    });
  </script>

  <script>
    // Function to add sticky effect
    window.addEventListener("scroll", function () {
      const header = document.querySelector("header");
      if (window.scrollY > 50) {
        header.classList.add("sticky");
      } else {
        header.classList.remove("sticky");
      }

    });

  </script>
  <!-- Show More/Show Less script for portfolio -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const showMoreWebButton = document.getElementById("show-more-web");
      const hideWebButton = document.getElementById("hide-web");
      const webCards = document.querySelectorAll(".web-portfolio .card");

      const cardsPerRow = 3; // Number of cards per row
      const visibleRows = 1; // Number of rows to display initially

      // Function to hide extra cards
      function hideExtraCards(cards) {
        cards.forEach((card, index) => {
          if (index >= visibleRows * cardsPerRow) {
            card.classList.add("hidden");
          }
        });
      }

      // Initially hide extra web and programming cards
      hideExtraCards(webCards);

      // Show More and Hide for Web Development
      showMoreWebButton.addEventListener("click", () => {
        webCards.forEach(card => card.classList.remove("hidden"));
        showMoreWebButton.classList.add("hidden");
        hideWebButton.classList.remove("hidden");
      });

      hideWebButton.addEventListener("click", () => {
        hideExtraCards(webCards);
        showMoreWebButton.classList.remove("hidden");
        hideWebButton.classList.add("hidden");
      });


    });
  </script>

  <!-- Navigation toggle script -->
  <script>
    function toggleMenu() {
      const menu = document.getElementById("menu");
      menu.classList.toggle("active");
    }
  </script>

  <!-- Typewriter effect script -->
  <script>
    document.addEventListener("DOMContentLoaded", function (event) {
      var dataText = [
        "a C/C++ Enthusiast üíª.",
        "skilled in JavaScript & Web Tech üåê.",
        "a HTML/CSS Artist üé®.",
        "a creative Figma Designer ‚úèÔ∏è.",
        "a master of Frameworks: Bootstrap, ReactJS, ThreeJS, SpringBoot üõ†Ô∏è.",
        "a database Whiz: MongoDB, MySQL, SQL/SQLite üóÉÔ∏è.",
        "hands-on with Deployment Tools like Render and AWS ‚òÅÔ∏è."
      ];


      function typeWriter(text, i, fnCallback) {
        if (i < text.length) {
          document.querySelector(".typewriter-text").innerHTML =
            text.substring(0, i + 1) + '<span aria-hidden="true"></span>';

          setTimeout(function () {
            typeWriter(text, i + 1, fnCallback);
          }, 50);
        } else if (typeof fnCallback === "function") {
          setTimeout(fnCallback, 1000);
        }
      }

      function StartTextAnimation(i) {
        if (i >= dataText.length) {
          i = 0;
        }
        typeWriter(dataText[i], 0, function () {
          StartTextAnimation(i + 1);
        });
      }
      StartTextAnimation(0);
    });
  </script>

  <!-- lazysizes script for deferred offscreen images -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.2/lazysizes.min.js" async></script>

  <!-- Three.js & Orbit/GLTFLoader scripts -->
  <script src="https://cdn.jsdelivr.net/npm/three@latest/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three/examples/js/loaders/GLTFLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three/examples/js/controls/OrbitControls.js"></script>

  <script>
    // Grab container
    const container = document.getElementById('three-container');

    // Scene, Camera, Renderer
    const scene = new THREE.Scene();
    scene.background = null; // Transparent background

    const camera = new THREE.PerspectiveCamera(
      75,
      container.clientWidth / container.clientHeight,
      0.1,
      1000
    );
    camera.position.set(0, 0, 6);

    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(container.clientWidth, container.clientHeight);
    container.appendChild(renderer.domElement);

    // OrbitControls: allow mouse to rotate the view
    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true; // Enables inertia for a smoother experience
    controls.dampingFactor = 0.05;

    // Light
    const ambientLight = new THREE.AmbientLight(0xffffff, 1.5);
    scene.add(ambientLight);

    // GLTF Loader: load the GLB model and play its animation (if any)
    const loader = new THREE.GLTFLoader();
    let model, mixer;
    const clock = new THREE.Clock(); // For animation timing

    loader.load(
      'earth_cartoon.glb', // Replace with your GLB file path
      function (gltf) {
        model = gltf.scene;
        scene.add(model);
        // Optionally adjust model scale and position
        model.position.set(0, 0, 0);
        model.scale.set(2.5, 2.5, 2.5);

        // If there are animations, create an AnimationMixer and play the first animation
        if (gltf.animations && gltf.animations.length > 0) {
          mixer = new THREE.AnimationMixer(model);
          const action = mixer.clipAction(gltf.animations[0]);
          action.play();
        }
      },
      undefined,
      function (error) {
        console.error('Error loading GLB model:', error);
      }
    );

    // Animation loop: update animations, controls, and render the scene
    function animate() {
      requestAnimationFrame(animate);
      const delta = clock.getDelta();
      if (mixer) {
        mixer.update(delta);
      }
      if (model) {
        // Rotate the model around its Y-axis
        model.rotation.y += 0.01;
      }
      controls.update(); // Update OrbitControls for smooth damping
      renderer.render(scene, camera);
    }
    animate();

    // Update renderer and camera on window resize
    window.addEventListener('resize', () => {
      camera.aspect = container.clientWidth / container.clientHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(container.clientWidth, container.clientHeight);
    });
  </script>



  <!-- <script>

    // Grab container
    const container = document.getElementById('three-container');

    // Scene, Camera, Renderer
    const scene = new THREE.Scene();
    scene.background = null; // Transparent

    const camera = new THREE.PerspectiveCamera(
      75,
      container.clientWidth / container.clientHeight,
      0.1,
      1000
    );
    camera.position.set(0, 0, 6);

    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(container.clientWidth, container.clientHeight);
    container.appendChild(renderer.domElement);

    // Light
    const ambientLight = new THREE.AmbientLight(0xffffff, 1.5);
    scene.add(ambientLight);

    // Raycaster & mouse
    const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector2();

    // Track mouse state
    let isMouseDown = false;

    // Targets
    const mouseTarget = new THREE.Vector3(0, 0, 0);  // Where fish goes when mouse is down
    const randomTarget = new THREE.Vector3(0, 0, 0); // Where fish goes when mouse is up

    // Fish model & animation
    let fish, mixer, action;
    let isActionPlaying = false;   // Whether the animation is currently playing
    let animationStartTime = 0;    // Timestamp when 2s animation started

    // Constants
    const clock = new THREE.Clock();
    const FISH_SPEED = 2.65;           // Fish movement speed
    const TURN_SPEED = 0.07;           // How quickly fish rotates toward target
    const MIN_SPEED = 0.1;             // Speed threshold to trigger 2s animation
    const RANDOM_RANGE = 5;            // Defines how far from origin the fish can wander

    // Orientation offset (rotate 180¬∞ around Y if needed)
    const offsetEuler = new THREE.Euler(0, Math.PI, 0, 'XYZ');
    const offsetQuaternion = new THREE.Quaternion().setFromEuler(offsetEuler);

    // Keep fish in screen bounds (adjust as needed)
    const BOUNDS = {
      minX: -5, maxX: 5,
      minY: -5, maxY: 5
    };

    function clampToScreen(obj) {
      obj.position.x = THREE.MathUtils.clamp(obj.position.x, BOUNDS.minX, BOUNDS.maxX);
      obj.position.y = THREE.MathUtils.clamp(obj.position.y, BOUNDS.minY, BOUNDS.maxY);
    }

    // Pick a random target (X, Y) in [-RANDOM_RANGE, RANDOM_RANGE]
    function pickRandomTarget() {
      randomTarget.set(
        THREE.MathUtils.randFloatSpread(RANDOM_RANGE * 2), // x
        THREE.MathUtils.randFloatSpread(RANDOM_RANGE * 2), // y
        0
      );
    }

    // Load the fish model
    const loader = new THREE.GLTFLoader();
    loader.load(
      'fish.glb', // Path to your fish model
      (gltf) => {
        fish = gltf.scene;
        fish.scale.set(10, 10, 10);
        fish.position.set(0, 0, 0);
        scene.add(fish);

        // Check if animations exist
        if (gltf.animations && gltf.animations.length > 0) {
          // Create an AnimationMixer and play the animation
          mixer = new THREE.AnimationMixer(fish);

          // Assuming you want to play the first animation
          action = mixer.clipAction(gltf.animations[0]);
          action.play();
        }

        // Initial random target for free swimming
        pickRandomTarget();
      },
      undefined,
      (err) => console.error('Error loading fish model:', err)
    );

    // Mouse events
    container.addEventListener('mousedown', () => {
      isMouseDown = true;
    });
    container.addEventListener('mouseup', () => {
      isMouseDown = false;
      // As soon as mouse is released, pick a new random target
      pickRandomTarget();
    });
    container.addEventListener('mousemove', (event) => {
      if (!isMouseDown) return; // Only update mouseTarget if mouse is down

      const rect = container.getBoundingClientRect();
      mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
      mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;

      raycaster.setFromCamera(mouse, camera);
      const plane = new THREE.Plane(new THREE.Vector3(0, 0, 1), 0);
      const intersection = new THREE.Vector3();
      raycaster.ray.intersectPlane(plane, intersection);

      mouseTarget.copy(intersection);
    });

    // Main animation loop
    function animate() {
      requestAnimationFrame(animate);

      const delta = clock.getDelta();

      // Update animation mixer
      if (mixer) {
        mixer.update(delta);
      }

      if (fish) {
        // Decide which target: mouseTarget if isMouseDown, else randomTarget
        const activeTarget = isMouseDown ? mouseTarget : randomTarget;

        // Smooth turning
        const lookAtMatrix = new THREE.Matrix4();
        lookAtMatrix.lookAt(fish.position, activeTarget, fish.up);

        let targetQuat = new THREE.Quaternion().setFromRotationMatrix(lookAtMatrix);
        // Apply offset
        targetQuat.multiply(offsetQuaternion);
        // Slerp to that orientation
        fish.quaternion.slerp(targetQuat, TURN_SPEED);

        // Move toward the active target
        const direction = new THREE.Vector3().subVectors(activeTarget, fish.position);
        fish.position.add(direction.normalize().multiplyScalar(FISH_SPEED * delta));

        // If mouse not down and fish is going to random target,
        // once it arrives, pick a new random target
        if (!isMouseDown && fish.position.distanceTo(randomTarget) < 0.2) {
          pickRandomTarget();
        }

        // Keep fish on screen
        clampToScreen(fish);
      }

      renderer.render(scene, camera);
    }
    animate();

    // Resize handling
    window.addEventListener('resize', () => {
      camera.aspect = container.clientWidth / container.clientHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(container.clientWidth, container.clientHeight);
    });

  </script> -->

</body>

</html>